<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bot Surat Otomatis</title>
<style>
  body {
    font-family: "Times New Roman", serif;
    background-color: #f7f7f7;
    margin: 0;
    padding: 20px;
  }

  header {
    text-align: center;
    padding: 10px;
    background-color: #1e3a8a;
    color: white;
    border-radius: 10px;
    margin-bottom: 20px;
  }

  .container {
    max-width: 1000px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  label {
    display: block;
    margin-top: 10px;
    font-weight: bold;
  }

  input, textarea {
    width: 85%;
    max-width: 600px;
    padding: 5px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  button {
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #1e3a8a;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }

  button:hover {
    background-color: #153071;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
  }

  th, td {
    border: 1px solid #000000;
    padding: 8px;
    text-align: left;
  }

  th {
    background-color: #ffffff;
    text-align: center;
  }

  #suratOutput {
    margin-top: 30px;
    padding: 20px;
    border: 1px solid #ffffff;
    border-radius: 10px;
    background-color: #fff;
  }

  .footer {
    text-align: right;
    margin-top: 30px;
  }

  .kop {
    text-align: center;
    border-bottom: 3px solid black;
    padding-bottom: 8px;
    margin-bottom: 15px;
  }

  .kop img {
    width: 80px;
    height: auto;
    display: block;
    margin: 0 auto 5px auto;
  }

  .kop h2, .kop p {
    margin: 0;
    line-height: 1.4;
  }

  @media (max-width: 600px) {
    body {
      padding: 10px;
    }

    .container {
      padding: 10px;
    }

    table {
      font-size: 12px;
    }

    button {
      width: 100%;
    }

    input, textarea {
      width: 100%;
    }
  }
</style>
</head>
<body>

<header>
  <h2>Bot Surat Otomatis</h2>
  <p>Copyright AwrdiantExim</p>
</header>

<div class="container">
  <label for="nosurat">Nomor Urut Surat:</label>
  <input type="number" id="nosurat" placeholder="Isi angka tunggal (contoh: 1)">

  <label for="kepada">Nama Penerima:</label>
  <input type="text" id="kepada" placeholder="Consignee">

  <label for="alamat">Alamat:</label>
  <textarea id="alamat" rows="2" placeholder="Address"></textarea>
  
  <label for="date">Tanggal Surat:</label>
  <input type="date" id="tanggalSuratInput">

  <h3>Daftar Item</h3>
  <table id="itemTable">
    <thead>
      <tr>
        <th>No. Invoice</th>
        <th>Tanggal Invoice</th>
        <th>Nama Perusahaan</th>
        <th>NPWP</th>
        <th>No. Bukti Potong</th>
        <th>Penghasilan Bruto</th>
        <th>PPH yang Dipotong</th>
        <th>Aksi</th>
      </tr>
    </thead>
    <tbody id="itemBody"></tbody>
  </table>
  <button type="button" onclick="tambahItem()">+ Tambah Item</button>

  <br><br>
  <button type="button" onclick="generateSurat()">üìù Generate</button>
  <button type="button" id="downloadBtn" style="display:none;" onclick="downloadPDF()">üì• Download (PDF)</button>

  <div id="suratOutput"></div>
</div>

<!-- CDN html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
function tambahItem() {
  const tbody = document.getElementById("itemBody");
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" placeholder="No. Invoice"></td>
    <td><input type="date"></td>
    <td><input type="text" placeholder="Nama Perusahaan"></td>
    <td><input type="text" placeholder="NPWP"></td>
    <td><input type="text" placeholder="No. Bukti Potong"></td>
    <td><input type="number" placeholder="Penghasilan Bruto"></td>
    <td><input type="number" placeholder="PPH yang Dipotong"></td>
    <td><button onclick="hapusBaris(this)">Hapus</button></td>
  `;
  tbody.appendChild(row);
}

function hapusBaris(btn) {
  btn.parentElement.parentElement.remove();
}

function bulanRomawi(bulan) {
  const romawi = ["I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII"];
  return romawi[bulan - 1];
}

function generateSurat() {
  const nomor = document.getElementById("nosurat").value || "001";
  const kepada = document.getElementById("kepada").value;
  const alamat = document.getElementById("alamat").value;
  const tanggalInput = document.getElementById("tanggalSuratInput").value;

  const tanggalObj = tanggalInput ? new Date(tanggalInput) : new Date();
  const tahun = tanggalObj.getFullYear();
  const bulan = tanggalObj.getMonth() + 1;
  const romawi = bulanRomawi(bulan);

  const nomorSurat = `${String(nomor).padStart(3, '0')}/YTI/${romawi}/${tahun}`;

  const rows = document.querySelectorAll("#itemBody tr");

  let totalBruto = 0;
  let totalPPH = 0;
  let tableContent = "";

  rows.forEach((row, index) => {
    const invoice = row.cells[0].querySelector("input").value;
    const tanggal = row.cells[1].querySelector("input").value;
    const perusahaan = row.cells[2].querySelector("input").value;
    const npwp = row.cells[3].querySelector("input").value;
    const bukti = row.cells[4].querySelector("input").value;
    const bruto = parseFloat(row.cells[5].querySelector("input").value) || 0;
    const pph = parseFloat(row.cells[6].querySelector("input").value) || 0;

    totalBruto += bruto;
    totalPPH += pph;

    tableContent += `
      <tr>
        <td>${index + 1}</td>
        <td>${invoice}</td>
        <td>${tanggal}</td>
        <td>${perusahaan}</td>
        <td>${npwp}</td>
        <td>${bukti}</td>
        <td style="text-align:right;">${bruto.toLocaleString("id-ID")}</td>
        <td style="text-align:right;">${pph.toLocaleString("id-ID")}</td>
      </tr>`;
  });

  tableContent += `
    <tr style="font-weight:bold; background-color:#fff;">
      <td colspan="6" style="text-align:center;">TOTAL</td>
      <td style="text-align:right;">${totalBruto.toLocaleString("id-ID")}</td>
      <td style="text-align:right;">${totalPPH.toLocaleString("id-ID")}</td>
    </tr>
  `;

  const tanggalSurat = tanggalObj.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });

  const suratHTML = `
    <div class="kop" style="text-align: center; margin-bottom: 20px;">
      <img src="logo.jpg" alt="Logo" style="width: 350px; height: auto; margin-bottom: 2px;">
      <h2 style="font-size: 28px; margin: 0;">PT Young Tree Industries</h2>
      <p style="margin: 3px 0; font-size: 16px;">Jl. Slamet Riyadi No.258, Dusun III, Gumpang, Kec. Kartasura, Kabupaten Sukoharjo, Jawa Tengah 57169</p>
      <p style="margin: 3px 0; font-size: 16px;">Telp: (021) 888 999 | Email:</p>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
      <p style="margin: 0;"><strong>No&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: ${nomorSurat}</strong></p>
      <p style="margin: 0; padding-right: 10px;"><strong>${tanggalSurat}</strong></p>
    </div>

    <p>Kepada Yth,<br>
    <strong>${kepada}</strong><br>
    ${alamat}</p>

    <p>Dengan hormat,</p>
    <p>Dengan ini, kami mengajukan permohonan reimbursement pemotongan PPh pasal 23 sebesar 
       <strong>Rp ${totalPPH.toLocaleString("id-ID")}</strong>.
    </p>
    <br>
    <p>Sebagaimana terlampir.</p>

    <table style="width: 100%; border-collapse: collapse; text-align: center;">
      <thead>
        <tr>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">No</th>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">No. Invoice</th>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">Tanggal Invoice</th>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">Nama Perusahaan</th>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">NPWP</th>
          <th rowspan="2" style="border: 1px solid #000; padding: 5px;">No. Bukti Potong</th>
          <th colspan="2" style="border: 1px solid #000; padding: 5px;">Jumlah</th>
        </tr>
        <tr>
          <th style="border: 1px solid #000; padding: 5px;">Penghasilan Bruto</th>
          <th style="border: 1px solid #000; padding: 5px;">PPH yang Dipotong</th>
        </tr>
      </thead>
      <tbody>${tableContent}</tbody>
    </table>

    <p>Demikian surat ini kami sampaikan. Atas perhatian dan kerja samanya kami ucapkan terima kasih.</p>

    <div class="footer" style="text-align: right; margin-top: 40px;">
      <p>Surakarta, ${tanggalSurat}<br><br><br>
      <strong>(____________________)</strong></p>
    </div>
  `;

  document.getElementById("suratOutput").innerHTML = suratHTML;
  document.getElementById("downloadBtn").style.display = "inline-block";
}

function downloadPDF() {
  const element = document.getElementById("suratOutput");
  const opt = {
    margin: 10,
    filename: 'Surat_Permohonan.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };
  html2pdf().set(opt).from(element).save();
}
</script>

</body>
</html>
